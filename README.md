# go-sse-sensor-dashboard-demo

## Server-Sent Events (SSE)

‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏ó‡∏Ñ‡πÇ‡∏ô‡πÇ‡∏•‡∏¢‡∏µ‡∏ó‡∏µ‡πà‡∏ä‡πà‡∏ß‡∏¢‡πÉ‡∏´‡πâ‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏ö‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏•‡πÑ‡∏ó‡∏°‡πå‡∏°‡∏≤‡∏¢‡∏±‡∏á‡πÄ‡∏ß‡πá‡∏ö‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå‡∏Ç‡∏≠‡∏á‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏ú‡πà‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ HTTP ‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡∏¥‡∏î‡πÑ‡∏ß‡πâ‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß ‡πÇ‡∏î‡∏¢‡πÑ‡∏°‡πà‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏´‡πâ‡πÑ‡∏Ñ‡∏•‡πÄ‡∏≠‡∏ô‡∏ï‡πå‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏Ç‡∏≠‡πÉ‡∏´‡∏°‡πà‡∏ã‡πâ‡∏≥‡πÜ SSE ‡∏ñ‡∏π‡∏Å‡∏≠‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö‡∏°‡∏≤‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Å‡∏≤‡∏£‡∏™‡∏∑‡πà‡∏≠‡∏™‡∏≤‡∏£‡∏ó‡∏¥‡∏®‡∏ó‡∏≤‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß (one-way communication) ‡∏à‡∏≤‡∏Å‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡πÑ‡∏Ñ‡∏•‡πÄ‡∏≠‡∏ô‡∏ï‡πå ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÅ‡∏ö‡∏ö real-time ‡πÄ‡∏ä‡πà‡∏ô ‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô, ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏•‡∏≤‡∏î‡∏´‡∏∏‡πâ‡∏ô, ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ ‡∏´‡∏£‡∏∑‡∏≠ feed ‡∏Ç‡πà‡∏≤‡∏ß‡∏™‡∏î ‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡πâ‡∏ô

‡∏î‡πâ‡∏ß‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏ö‡∏ô‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á‡πÇ‡∏õ‡∏£‡πÇ‡∏ï‡∏Ñ‡∏≠‡∏• HTTP ‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ ‡∏ó‡∏≥‡πÉ‡∏´‡πâ SSE ‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏á‡πà‡∏≤‡∏¢‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á ‡πÇ‡∏î‡∏¢‡πÑ‡∏°‡πà‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ‡πÇ‡∏õ‡∏£‡πÇ‡∏ï‡∏Ñ‡∏≠‡∏•‡∏û‡∏¥‡πÄ‡∏®‡∏©‡∏´‡∏£‡∏∑‡∏≠‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ó‡∏µ‡πà‡∏ã‡∏±‡∏ö‡∏ã‡πâ‡∏≠‡∏ô ‡πÅ‡∏ï‡πà‡∏Å‡πá‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏î‡πâ‡∏≤‡∏ô‡πÄ‡∏ä‡πà‡∏ô ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÉ‡∏ä‡πâ HTTP/2 ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏õ‡∏£‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏†‡∏≤‡∏û‡πÑ‡∏î‡πâ...[‡∏≠‡πà‡∏≤‡∏ô‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö SSE](docs/sse.md)

```mermaid
graph LR
    subgraph "Frontend"
        UI[REST Client]
        SSEClient[SSE Client]
    end
    
    subgraph "Backend (Go)"
        API[REST API]
        SSE[SSE Endpoint]
        Cache[Local Cache]
        Service[Sensor Service]
        Repository[Sensor Repository]
    end
    
    UI -->|HTTP Requests/Responses| API
    SSEClient -->|EventSource Connect| SSE
    API -->|Get Data| Service
    SSE -->|Get Data| Service
    SSE -->|Stream Data| SSEClient
    Service -->|Cache Data| Cache
    Cache -->|Retrieve Data| Service
    Service -->|CRUD Operations| Repository
    
    classDef frontend fill:#64B5F6,stroke:#1976D2,stroke-width:2px,color:#fff
    classDef api fill:#7986CB,stroke:#3F51B5,stroke-width:2px,color:#fff
    classDef service fill:#FFB74D,stroke:#F57C00,stroke-width:2px,color:#fff
    classDef cache fill:#BA68C8,stroke:#7B1FA2,stroke-width:2px,color:#fff
    classDef repo fill:#E57373,stroke:#D32F2F,stroke-width:2px,color:#fff
    
    class UI,SSEClient frontend
    class API,SSE api
    class Service service
    class Cache cache
    class Repository repo
```

‡∏Å‡∏≤‡∏£‡∏ó‡∏≥ **load test SSE endpoint** ‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏£‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏ó‡∏µ‡πà‡∏Ñ‡∏ß‡∏£‡∏û‡∏¥‡∏à‡∏≤‡∏£‡∏ì‡∏≤‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡∏ó‡∏≥ loadtest ‡∏ö‡∏ô REST API endpoint ‡∏õ‡∏Å‡∏ï‡∏¥
‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏≠‡πà‡∏≤‡∏ô‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°‡πÑ‡∏î‡πâ‡∏ó‡∏µ‡πà [‡∏Å‡∏≤‡∏£‡∏ó‡∏≥ load test SSE endpoint](docs/sse-loadtest.md)

‡∏î‡∏π‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ k6 ‡∏£‡πà‡∏ß‡∏°‡∏Å‡∏±‡∏ö plugin k6-sse ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö loadtest ‡πÅ‡∏•‡∏∞ tuning loadbalancing ‡∏î‡πâ‡∏ß‡∏¢ Nginx ‚Äì ‡∏Ñ‡∏•‡∏¥‡∏Å‡∏ó‡∏µ‡πà [Loadtest ‡∏î‡πâ‡∏ß‡∏¢ k6-sse](#loadtest-‡∏î‡πâ‡∏ß‡∏¢-k6-sse)

```mermaid
graph LR
    K6[k6 ‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô<br>‚ùå ‡πÑ‡∏°‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö SSE]
    XK6[xk6<br>k6 extension builder]
    SSE[xk6-sse<br>SSE extension]
    CustomK6[Custom k6<br>‚úì ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö SSE]
    LoadTestSSE[Load Test<br>‡∏ó‡∏î‡∏™‡∏≠‡∏ö SSE Server]
    
    K6 -->|‡∏Ç‡πâ‡∏≠‡∏à‡∏≥‡∏Å‡∏±‡∏î| XK6
    XK6 -->|‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô| SSE
    SSE -->|‡∏£‡∏ß‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡∏Å‡∏±‡∏ö k6| CustomK6
    CustomK6 -->|‡πÉ‡∏ä‡πâ‡∏ó‡∏≥| LoadTestSSE
    
    classDef standard fill:#E57373,stroke:#D32F2F,stroke-width:2px,color:#fff
    classDef builder fill:#64B5F6,stroke:#1976D2,stroke-width:2px,color:#fff
    classDef extension fill:#81C784,stroke:#388E3C,stroke-width:2px,color:#fff
    classDef custom fill:#FFB74D,stroke:#F57C00,stroke-width:2px,color:#fff
    classDef test fill:#BA68C8,stroke:#7B1FA2,stroke-width:2px,color:#fff
    
    class K6 standard
    class XK6 builder
    class SSE extension
    class CustomK6 custom
    class LoadTestSSE test
```

‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á SSE Messages

```plaintext
id: 1625482456
event: message
data: {"server_id":"container-a1b2c3","data":[{"id":"temp1","name":"‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥‡∏´‡πâ‡∏≠‡∏á 1","type":"temperature","value":25.7,"unit":"¬∞C","timestamp":1625482456},{"id":"hum1","name":"‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏∑‡πâ‡∏ô‡∏´‡πâ‡∏≠‡∏á 1","type":"humidity","value":65.3,"unit":"%","timestamp":1625482456}]}
```

- `id`: ‡πÄ‡∏õ‡πá‡∏ô Unix timestamp ‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô ‡∏ã‡∏∂‡πà‡∏á‡πÉ‡∏ä‡πâ‡πÄ‡∏õ‡πá‡∏ô Event ID ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÉ‡∏´‡∏°‡πà
- `event`: ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Ç‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°: "message" ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏õ‡∏Å‡∏ï‡∏¥, "ping" ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏£‡∏±‡∏Å‡∏©‡∏≤‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠
- `data`: ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• JSON ‡∏ó‡∏µ‡πà‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡∏î‡πâ‡∏ß‡∏¢:
  - `server_id`: ‡∏£‡∏´‡∏±‡∏™‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ó‡∏µ‡πà‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (‡∏ä‡πà‡∏ß‡∏¢‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏±‡∏á‡πÄ‡∏Å‡∏ï‡∏ß‡πà‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏°‡∏≤‡∏à‡∏≤‡∏Å‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ï‡∏±‡∏ß‡πÑ‡∏´‡∏ô‡πÉ‡∏ô‡∏Å‡∏£‡∏ì‡∏µ‡∏°‡∏µ‡∏´‡∏•‡∏≤‡∏¢‡∏ï‡∏±‡∏ß)
  - `data`: ‡∏≠‡∏≤‡πÄ‡∏£‡∏¢‡πå‡∏Ç‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏ã‡∏ô‡πÄ‡∏ã‡∏≠‡∏£‡πå

![Sensor Dashboard](/resources/imgs/sensor-dashboard-sse.png)

```mermaid
sequenceDiagram
    participant Client as Client (Browser)
    participant Handler as SSE Handler
    participant Service as Sensor Service
    participant Cache as Cache
    participant Repo as Sensor Repository
    
    Client->>Handler: HTTP Request to /api/sensors/stream
    Handler->>Handler: Set SSE Headers
    Handler->>Service: GetAllSensors()
    Service->>Cache: Check Cache
    
    alt Cache Hit
        Cache-->>Service: Return Cached Data
    else Cache Miss
        Service->>Repo: GetAllSensors()
        Repo-->>Service: Return Sensor Data
        Service->>Cache: Store in Cache
    end
    
    Service-->>Handler: Return JSON Data
    Handler->>Client: Send Initial Data with event-id
    
    loop Every 2 seconds
        Handler->>Service: GetAllSensors()
        Service->>Cache: Check Cache
        
        alt Cache Hit
            Cache-->>Service: Return Cached Data
        else Cache Miss
            Service->>Repo: GetAllSensors()
            Repo-->>Service: Return Sensor Data
            Service->>Cache: Store in Cache
        end
        
        Service-->>Handler: Return JSON Data
        Handler->>Client: Send Updated Data with event-id
    end
    
    loop Every 30 seconds
        Handler->>Client: Send Ping Event
    end
    
    Client->>Handler: Connection Closed
    Handler->>Handler: Clean up resources
```

```mermaid
graph TD
    subgraph Client
        Browser[Browser]
    end
    
    subgraph Backend
        subgraph Router
            Echo[Echo Framework]
            Routes[API Routes]
        end
        
        subgraph Handlers
            SensorHandler[Sensor Handler]
        end
        
        subgraph Services
            SensorService[Sensor Service]
        end
        
        subgraph Repository
            SensorRepo[Sensor Repository]
        end
        
        subgraph Cache
            LocalCache[Local Memory Cache]
        end
    end
    
    Browser -->|HTTP Request| Echo
    Echo -->|Route Request| Routes
    Routes -->|API Call| SensorHandler
    SensorHandler -->|Get Data| SensorService
    SensorService -->|Check Cache| LocalCache
    LocalCache -->|Cache Miss| SensorService
    SensorService -->|Fetch Data| SensorRepo
    SensorRepo -->|Return Data| SensorService
    SensorService -->|Store in Cache| LocalCache
    SensorService -->|Return Data| SensorHandler
    SensorHandler -->|SSE Stream| Browser
    
    classDef client fill:#64B5F6,stroke:#1976D2,stroke-width:2px,color:#fff
    classDef echo fill:#7986CB,stroke:#3F51B5,stroke-width:2px,color:#fff
    classDef handler fill:#81C784,stroke:#388E3C,stroke-width:2px,color:#fff
    classDef service fill:#FFB74D,stroke:#F57C00,stroke-width:2px,color:#fff
    classDef cache fill:#BA68C8,stroke:#7B1FA2,stroke-width:2px,color:#fff
    classDef repo fill:#E57373,stroke:#D32F2F,stroke-width:2px,color:#fff
    
    class Browser client
    class Echo,Routes echo
    class SensorHandler handler
    class SensorService service
    class LocalCache cache
    class SensorRepo repo
```

### ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô Event ID ‡πÉ‡∏ô SSE

‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏ñ‡∏π‡∏Å‡∏ï‡∏±‡∏î ‡πÅ‡∏•‡∏∞‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÉ‡∏´‡∏°‡πà‡πÑ‡∏õ‡∏¢‡∏±‡∏á sse endpoint  
client ‡πÉ‡∏ô‡∏ù‡∏±‡πà‡∏á‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå‡∏à‡∏∞‡∏™‡πà‡∏á ID ‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡πÑ‡∏õ‡πÑ‡∏ß‡πâ‡πÉ‡∏ô‡∏™‡πà‡∏ß‡∏ô‡∏´‡∏±‡∏ß `Last-Event-ID`  
‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ù‡∏±‡πà‡∏á server ‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏Ñ‡πà‡∏≤‡∏î‡∏±‡∏á‡∏Å‡∏•‡πà‡∏≤‡∏ß‡∏Å‡πá‡∏à‡∏∞‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ó‡∏£‡∏≤‡∏ö‡πÑ‡∏î‡πâ‡∏ß‡πà‡∏≤ client ‡∏ô‡∏µ‡πâ‡πÄ‡∏Ñ‡∏¢‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏≠‡∏∞‡πÑ‡∏£‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß‡∏ö‡πâ‡∏≤‡∏á‡∏Å‡πá‡∏à‡∏∞‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏õ‡πÉ‡∏´‡πâ client ‡πÑ‡∏î‡πâ‡∏ï‡∏≤‡∏° logic ‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£  

```mermaid
graph LR
    A[üîÑ<br>‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ SSE] --> B[üíæ<br>‡∏£‡∏±‡∏ö ID: 1002]
    B --> C[‚ùå<br>‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏´‡∏•‡∏∏‡∏î]
    C --> D[üîÑ<br>‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÉ‡∏´‡∏°‡πà<br>+ Last-Event-ID]
    D --> E[‚úÖ<br>‡∏£‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡πà‡∏≠‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á]
    
    classDef connect fill:#64B5F6,stroke:#1976D2,stroke-width:2px,color:#fff
    classDef store fill:#BA68C8,stroke:#7B1FA2,stroke-width:2px,color:#fff
    classDef error fill:#E57373,stroke:#D32F2F,stroke-width:2px,color:#fff
    classDef reconnect fill:#FFB74D,stroke:#F57C00,stroke-width:2px,color:#fff
    classDef resume fill:#81C784,stroke:#388E3C,stroke-width:2px,color:#fff
    
    class A connect
    class B store
    class C error
    class D reconnect
    class E resume
```

‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Last-Event-ID ‡∏ó‡∏µ‡πà‡∏ù‡∏±‡πà‡∏á server ‡∏ó‡∏≥‡πÑ‡∏î‡πâ‡∏î‡∏±‡∏á‡∏ô‡∏µ‡πâ

```go
// ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Last-Event-ID ‡∏à‡∏≤‡∏Å request header (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)
lastEventID := c.Request().Header.Get("Last-Event-ID")
var lastTimestamp int64

if lastEventID != "" {
    // ‡πÅ‡∏õ‡∏•‡∏á string ‡πÄ‡∏õ‡πá‡∏ô int64
    var err error
    lastTimestamp, err = strconv.ParseInt(lastEventID, 10, 64)
    if err != nil {
        h.logger.Warn("Invalid Last-Event-ID received",
            zap.String("last_event_id", lastEventID),
            zap.Error(err))
    } else {
        h.logger.Info("Reconnection with Last-Event-ID",
            zap.Int64("last_event_id", lastTimestamp),
            zap.String("client_ip", c.RealIP()))
    }
}
```

### ‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏ö SSE ‡∏à‡∏≤‡∏Å‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå‡πÉ‡∏ô‡∏ù‡∏±‡πà‡∏á‡∏ü‡∏£‡∏≠‡∏ô‡∏ï‡πå‡πÄ‡∏≠‡∏ô‡∏î‡πå

‡∏ù‡∏±‡πà‡∏á‡∏ü‡∏£‡∏≠‡∏ô‡∏ï‡πå‡πÄ‡∏≠‡∏ô‡∏î‡πå‡πÉ‡∏ä‡πâ JavaScript ‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÅ‡∏•‡∏∞‡∏£‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• SSE ‡∏î‡∏±‡∏á‡∏ô‡∏µ‡πâ:

```javascript
// ‡∏™‡∏£‡πâ‡∏≤‡∏á function ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö SSE connection ‡∏û‡∏£‡πâ‡∏≠‡∏° retry
function connectSSE() {
    console.log('Connecting to SSE...');
    
    // ‡πÅ‡∏™‡∏î‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î
    document.getElementById("temperature").textContent = "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...";
    document.getElementById("humidity").textContent = "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...";
    document.getElementById("timestamp").textContent = "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠...";
    document.getElementById("server-id").textContent = "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏£‡∏≠‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...";
    
    const eventSource = new EventSource('/api/sensors/stream');
    
    eventSource.onopen = function() {
        console.log('SSE connection established');
    };

    eventSource.onmessage = function(event) {
        try {
            // ‡πÅ‡∏õ‡∏•‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• JSON
            let data = JSON.parse(event.data);
            
            // ‡πÅ‡∏™‡∏î‡∏á server ID ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏´‡πá‡∏ô‡∏ß‡πà‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏°‡∏≤‡∏à‡∏≤‡∏Å‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ï‡∏±‡∏ß‡πÑ‡∏´‡∏ô
            if (data.server_id) {
                document.getElementById("server-id").textContent = data.server_id;
            }
            
            // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ñ‡πà‡∏≤‡∏ö‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠
            if (data.data && Array.isArray(data.data) && data.data.length > 0) {
                // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î
                updateDashboardCards(data.data);
                // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Å‡∏£‡∏≤‡∏ü
                updateCharts(data.data);
                // ‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏ã‡∏ô‡πÄ‡∏ã‡∏≠‡∏£‡πå
                displaySensorsList(data.data);
            }
        } catch (error) {
            console.warn("Error processing sensor data:", error);
        }
    };

    eventSource.onerror = function(error) {
        console.error('SSE connection error:', error);
        document.getElementById("server-id").textContent = "‡∏Ç‡∏≤‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠";
        // ‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÉ‡∏´‡∏°‡πà‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÇ‡∏î‡∏¢‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå‡πÇ‡∏î‡∏¢‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
    };
    
    return eventSource;
}
```

‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÑ‡∏Ñ‡∏•‡πÄ‡∏≠‡∏ô‡∏ï‡πå‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÉ‡∏´‡∏°‡πà ‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå‡∏à‡∏∞‡∏™‡πà‡∏á `Last-Event-ID` ‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå‡πÇ‡∏î‡∏¢‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥ ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ó‡∏£‡∏≤‡∏ö‡∏ß‡πà‡∏≤‡πÑ‡∏Ñ‡∏•‡πÄ‡∏≠‡∏ô‡∏ï‡πå‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢‡∏Ñ‡∏∑‡∏≠‡∏≠‡∏∞‡πÑ‡∏£‡πÅ‡∏•‡∏∞‡∏ï‡∏≠‡∏ö‡∏™‡∏ô‡∏≠‡∏á‡πÑ‡∏î‡πâ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á

## ‡∏Å‡∏≤‡∏£‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡πÄ‡∏ß‡∏•‡∏≤‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î‡∏Ç‡∏≠‡∏á SSE connection

**‡∏ó‡∏µ‡πà‡∏ù‡∏±‡πà‡∏á server** ‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÄ‡∏ß‡∏•‡∏≤‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î‡∏Ç‡∏≠‡∏á SSE connection ‡πÑ‡∏ß‡πâ‡∏ó‡∏µ‡πà `APP_WRITE_TIMEOUT` ‡πÄ‡∏ó‡πà‡∏≤‡∏Å‡∏±‡∏ö 10 ‡∏ô‡∏≤‡∏ó‡∏µ  
‡∏ã‡∏∂‡πà‡∏á‡∏Ñ‡πà‡∏≤‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏ô‡∏≥‡πÑ‡∏õ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÉ‡∏´‡πâ‡∏Å‡∏±‡∏ö `WriteTimeout` ‡∏Ç‡∏≠‡∏á Echo Web Framework ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡πÄ‡∏ß‡∏•‡∏≤‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î‡∏Ç‡∏≠‡∏á SSE connection
‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏ô‡∏µ‡πâ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡πÉ‡∏ô‡∏Å‡∏£‡∏ì‡∏µ‡∏ó‡∏µ‡πà client ‡πÑ‡∏°‡πà‡∏¢‡∏≠‡∏°‡∏õ‡∏¥‡∏î connection ‡∏ã‡∏∂‡πà‡∏á‡∏≠‡∏≤‡∏à‡∏ó‡∏≥‡πÉ‡∏´‡πâ server ‡∏£‡∏≠‡∏Ñ‡∏≠‡∏¢‡∏Å‡∏≤‡∏£‡∏õ‡∏¥‡∏î connection ‡∏ô‡∏≤‡∏ô‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ

‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏ù‡∏±‡πà‡∏á client ‡∏ñ‡πâ‡∏≤ connection ‡∏ñ‡∏π‡∏Å‡∏õ‡∏¥‡∏î‡πÇ‡∏î‡∏¢‡∏ù‡∏±‡πà‡∏á server ‡∏Å‡πá‡∏Ñ‡πà‡∏≠‡∏¢‡∏ó‡∏≥‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÇ‡∏î‡∏¢‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÅ‡∏à‡πâ‡∏á server ‡πÑ‡∏î‡πâ‡∏ß‡πà‡∏≤‡πÄ‡∏Ñ‡∏¢‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö `Last-Event-ID` ‡∏≠‡∏∞‡πÑ‡∏£‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß‡∏ö‡πâ‡∏≤‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏ï‡∏≤‡∏° logic ‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÑ‡∏î‡πâ

## ‡∏Å‡∏≤‡∏£‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏•‡∏∞‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô

### ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á

1. Clone repository:

   ```sh
   git clone https://github.com/yourusername/go-sse-demo-sensor-dashboard.git
   cd go-sse-demo-sensor-dashboard
   ```

2. ‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á dependencies

   ```sh
   go mod tidy
   ```

3. ‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏û‡∏±‡∏í‡∏ô‡∏≤

   ```sh
   make install-dev-tools
   ```

### ‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Configuration

‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Ñ‡∏ô‡∏µ‡πâ‡πÉ‡∏ä‡πâ‡πÑ‡∏ü‡∏•‡πå configuration ‡πÅ‡∏¢‡∏Å‡∏ï‡∏≤‡∏°‡∏™‡∏†‡∏≤‡∏û‡πÅ‡∏ß‡∏î‡∏•‡πâ‡∏≠‡∏°‡πÅ‡∏ö‡∏ö‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÄ‡∏à‡∏≤‡∏∞‡∏à‡∏á:

- `.env.dev`: ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡∏†‡∏≤‡∏û‡πÅ‡∏ß‡∏î‡∏•‡πâ‡∏≠‡∏° development
- `.env.uat`: ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡∏†‡∏≤‡∏û‡πÅ‡∏ß‡∏î‡∏•‡πâ‡∏≠‡∏° UAT
- `.env.prod`: ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡∏†‡∏≤‡∏û‡πÅ‡∏ß‡∏î‡∏•‡πâ‡∏≠‡∏° production

### Makefile

‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Ñ‡∏ô‡∏µ‡πâ‡∏°‡∏µ‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á make ‡∏´‡∏•‡∏±‡∏Å‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏î‡∏±‡∏á‡∏ô‡∏µ‡πâ

- **`make`**: ‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡πà‡∏≤‡∏Å‡∏±‡∏ö `make run` ‡∏Ñ‡∏∑‡∏≠‡∏£‡∏±‡∏ô‡πÅ‡∏≠‡∏û‡∏û‡∏•‡∏¥‡πÄ‡∏Ñ‡∏ä‡∏±‡∏ô‡πÉ‡∏ô‡πÇ‡∏´‡∏°‡∏î development ‡πÇ‡∏î‡∏¢‡∏ï‡∏£‡∏á‡∏ö‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÇ‡∏Æ‡∏™‡∏ï‡πå (‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô Docker) ‡∏û‡∏£‡πâ‡∏≠‡∏° hot-reload
  - ‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡πÑ‡∏î‡πâ‡∏ó‡∏µ‡πà: <http://localhost:8080>
  - ‡∏Ç‡πâ‡∏≠‡∏î‡∏µ: ‡∏û‡∏±‡∏í‡∏ô‡∏≤‡πÑ‡∏î‡πâ‡∏£‡∏ß‡∏î‡πÄ‡∏£‡πá‡∏ß ‡∏°‡∏µ hot-reload
  - ‡πÉ‡∏ä‡πâ‡πÄ‡∏°‡∏∑‡πà‡∏≠: ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏û‡∏±‡∏í‡∏ô‡∏≤‡πÇ‡∏î‡∏¢‡πÄ‡∏´‡πá‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á‡∏ó‡∏±‡∏ô‡∏ó‡∏µ

- **`make dev`**: ‡∏£‡∏±‡∏ô‡πÅ‡∏≠‡∏û‡∏û‡∏•‡∏¥‡πÄ‡∏Ñ‡∏ä‡∏±‡∏ô‡πÉ‡∏ô‡πÇ‡∏´‡∏°‡∏î development ‡∏ú‡πà‡∏≤‡∏ô Docker container ‡∏û‡∏£‡πâ‡∏≠‡∏° hot-reload
  - ‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡πÑ‡∏î‡πâ‡∏ó‡∏µ‡πà: <http://localhost:8081>
  - ‡∏Ç‡πâ‡∏≠‡∏î‡∏µ: ‡∏°‡∏µ hot-reload ‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô `make run` ‡πÅ‡∏ï‡πà‡∏£‡∏±‡∏ô‡πÉ‡∏ô‡∏™‡∏†‡∏≤‡∏û‡πÅ‡∏ß‡∏î‡∏•‡πâ‡∏≠‡∏° Docker ‡∏ó‡∏µ‡πà‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡πÑ‡∏î‡πâ
  - ‡πÉ‡∏ä‡πâ‡πÄ‡∏°‡∏∑‡πà‡∏≠: ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏û‡∏±‡∏í‡∏ô‡∏≤‡πÉ‡∏ô‡∏™‡∏†‡∏≤‡∏û‡πÅ‡∏ß‡∏î‡∏•‡πâ‡∏≠‡∏°‡πÅ‡∏ö‡∏ö‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡∏ó‡∏µ‡πà‡∏à‡∏∞ deploy

- **`make uat`**: ‡∏£‡∏±‡∏ô‡πÅ‡∏≠‡∏û‡∏û‡∏•‡∏¥‡πÄ‡∏Ñ‡∏ä‡∏±‡∏ô‡πÉ‡∏ô‡πÇ‡∏´‡∏°‡∏î UAT ‡∏ú‡πà‡∏≤‡∏ô Docker container
  - ‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡πÑ‡∏î‡πâ‡∏ó‡∏µ‡πà: <http://localhost:8082>
  - ‡∏Ç‡πâ‡∏≠‡∏î‡∏µ: ‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏Å‡∏±‡∏ö‡∏™‡∏†‡∏≤‡∏û‡πÅ‡∏ß‡∏î‡∏•‡πâ‡∏≠‡∏°‡∏à‡∏£‡∏¥‡∏á‡πÅ‡∏ï‡πà‡πÑ‡∏°‡πà‡∏°‡∏µ load balancing
  - ‡πÉ‡∏ä‡πâ‡πÄ‡∏°‡∏∑‡πà‡∏≠: ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡πÅ‡∏≠‡∏û‡∏û‡∏•‡∏¥‡πÄ‡∏Ñ‡∏ä‡∏±‡∏ô‡∏Å‡πà‡∏≠‡∏ô‡∏Ç‡∏∂‡πâ‡∏ô production

- **`make prod`**: ‡∏£‡∏±‡∏ô‡πÅ‡∏≠‡∏û‡∏û‡∏•‡∏¥‡πÄ‡∏Ñ‡∏ä‡∏±‡∏ô‡πÉ‡∏ô‡πÇ‡∏´‡∏°‡∏î Production ‡∏ú‡πà‡∏≤‡∏ô Docker container ‡∏û‡∏£‡πâ‡∏≠‡∏° Nginx reverse proxy ‡πÅ‡∏•‡∏∞ load balancing
  - ‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡πÑ‡∏î‡πâ‡∏ó‡∏µ‡πà: <http://localhost:8083>
  - ‡∏Ç‡πâ‡∏≠‡∏î‡∏µ: ‡∏à‡∏≥‡∏•‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏™‡∏†‡∏≤‡∏û‡πÅ‡∏ß‡∏î‡∏•‡πâ‡∏≠‡∏°‡∏à‡∏£‡∏¥‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ‡∏£‡∏ß‡∏°‡∏ñ‡∏∂‡∏á‡∏°‡∏µ load balancing ‡∏î‡πâ‡∏ß‡∏¢ Nginx
  - ‡πÉ‡∏ä‡πâ‡πÄ‡∏°‡∏∑‡πà‡∏≠: ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡πÅ‡∏ö‡∏ö‡πÄ‡∏ï‡πá‡∏°‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏£‡∏ß‡∏°‡∏ñ‡∏∂‡∏á load balancing

‡∏™‡∏£‡∏∏‡∏õ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏ï‡∏Å‡∏ï‡πà‡∏≤‡∏á‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ï‡πà‡∏≤‡∏á‡πÜ

| ‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á | ‡∏™‡∏†‡∏≤‡∏û‡πÅ‡∏ß‡∏î‡∏•‡πâ‡∏≠‡∏° | Docker | Hot-reload | Load Balancing | ‡∏û‡∏≠‡∏£‡πå‡∏ï |
|-------|-------------|--------|------------|----------------|-------|
| `make` ‡∏´‡∏£‡∏∑‡∏≠ `make run` | dev | ‚ùå | ‚úÖ | ‚ùå | 8080 |
| `make dev` | dev | ‚úÖ | ‚úÖ | ‚ùå | 8081 |
| `make uat` | uat | ‚úÖ | ‚ùå | ‚ùå | 8082 |
| `make prod` | prod | ‚úÖ | ‚ùå | ‚úÖ (Nginx) | 8083 |

### ‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÅ‡∏ö‡∏ö‡∏õ‡∏Å‡∏ï‡∏¥

‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Ñ‡∏ô‡∏µ‡πâ‡πÉ‡∏ä‡πâ `make` ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏∞‡∏î‡∏ß‡∏Å‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏ô ‡πÅ‡∏•‡∏∞‡∏à‡∏∞‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ APP_ENV ‡πÉ‡∏´‡πâ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥:

- **‡∏£‡∏±‡∏ô‡πÉ‡∏ô‡πÇ‡∏´‡∏°‡∏î Development**:
  
  ```sh
  make run
  ```

- **‡∏£‡∏±‡∏ô‡∏î‡πâ‡∏ß‡∏¢ Hot-reload ‡πÉ‡∏ô Docker**:

  ```sh
  make dev
  ```

- **‡∏£‡∏±‡∏ô‡πÉ‡∏ô‡πÇ‡∏´‡∏°‡∏î UAT**:

  ```sh
  make uat
  ```

- **‡∏£‡∏±‡∏ô‡πÉ‡∏ô‡πÇ‡∏´‡∏°‡∏î Production**:

  ```sh
  make prod
  ```

- **‡∏£‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö**:

  ```sh
  make test
  ```

- **‡∏£‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏•‡∏∏‡∏°**:

  ```sh
  make test-coverage
  ```

- **‡∏î‡∏π‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î**:

  ```sh
  make help
  ```

- **‡∏´‡∏¢‡∏∏‡∏î containers**:

  ```sh
  make docker-stop
  ```

- **‡∏•‡πâ‡∏≤‡∏á Docker resources**:

  ```sh
  make docker-clean
  ```

## ‡∏™‡∏†‡∏≤‡∏û‡πÅ‡∏ß‡∏î‡∏•‡πâ‡∏≠‡∏°‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô

‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Ñ‡∏ô‡∏µ‡πâ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö 3 ‡∏™‡∏†‡∏≤‡∏û‡πÅ‡∏ß‡∏î‡∏•‡πâ‡∏≠‡∏°‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô ‡πÇ‡∏î‡∏¢‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏™‡∏†‡∏≤‡∏û‡πÅ‡∏ß‡∏î‡∏•‡πâ‡∏≠‡∏°‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏î‡πâ‡∏ß‡∏¢ APP_ENV:

1. **Development (dev)**: ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏û‡∏±‡∏í‡∏ô‡∏≤ ‡∏°‡∏µ hot-reload ‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£ debug
   - ‡∏£‡∏±‡∏ô‡πÇ‡∏î‡∏¢: `make run` ‡∏´‡∏£‡∏∑‡∏≠ `make dev`
   - ‡πÉ‡∏ä‡πâ `APP_ENV=dev` ‡πÅ‡∏•‡∏∞‡πÑ‡∏ü‡∏•‡πå configuration: `.env.dev`
   - ‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á static ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô: `../frontend/static`

2. **User Acceptance Testing (uat)**: ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡πà‡∏≠‡∏ô‡∏Ç‡∏∂‡πâ‡∏ô production
   - ‡∏£‡∏±‡∏ô‡πÇ‡∏î‡∏¢: `make uat`
   - ‡πÉ‡∏ä‡πâ `APP_ENV=uat` ‡πÅ‡∏•‡∏∞‡πÑ‡∏ü‡∏•‡πå configuration: `.env.uat`
   - ‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á static ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô: `/app/frontend/static` (‡πÉ‡∏ô Docker)
   - ‡∏û‡∏≠‡∏£‡πå‡∏ï: 8082 (‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏£‡∏±‡∏ô‡∏ú‡πà‡∏≤‡∏ô Docker)

3. **Production (prod)**: ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏à‡∏£‡∏¥‡∏á
   - ‡∏£‡∏±‡∏ô‡πÇ‡∏î‡∏¢: `make prod`, `make start`, ‡∏´‡∏£‡∏∑‡∏≠ `make docker-run-prod`
   - ‡πÉ‡∏ä‡πâ `APP_ENV=prod` ‡πÅ‡∏•‡∏∞‡πÑ‡∏ü‡∏•‡πå configuration: `.env.prod`
   - ‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á static ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô: `./frontend/static` (‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏£‡∏±‡∏ô‡∏î‡πâ‡∏ß‡∏¢ `make start`) ‡∏´‡∏£‡∏∑‡∏≠ `/app/frontend/static` (‡πÉ‡∏ô Docker)
   - ‡∏û‡∏≠‡∏£‡πå‡∏ï: 8083 (‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏£‡∏±‡∏ô‡∏ú‡πà‡∏≤‡∏ô Docker) ‡∏û‡∏£‡πâ‡∏≠‡∏° Nginx load balancing
   - ‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏ó‡∏≥ load balancing ‡∏î‡πâ‡∏ß‡∏¢ Nginx ‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á 3 instances ‡∏Ç‡∏≠‡∏á‡πÅ‡∏≠‡∏û‡∏û‡∏•‡∏¥‡πÄ‡∏Ñ‡∏ä‡∏±‡∏ô

## Nginx Load Balancing

```mermaid
graph LR
    subgraph "Deployment (make prod)"
        DEPLOY[üöÄ<br>make prod]
        DC[üê≥<br>docker-compose.prod.yml]
        
        subgraph "Backend Scaling"
            NGINX[üì° Nginx<br>Load Balancer]
            
            BE1[‚öôÔ∏è SSE Backend<br>Replica 1]
            BE2[‚öôÔ∏è SSE Backend<br>Replica 2]
            BE3[‚öôÔ∏è SSE Backend<br>Replica 3]
            BEN[... Replica N]
        end
    end
    
    CLIENT[üë• Clients] -->|Requests| NGINX
    
    DEPLOY -->|Executes| DC
    DC -->|Creates & Scales| BE1
    DC -->|Creates & Scales| BE2
    DC -->|Creates & Scales| BE3
    DC -->|Creates & Scales| BEN
    DC -->|Configures| NGINX
    
    NGINX -->|Distributes Traffic| BE1
    NGINX -->|Distributes Traffic| BE2
    NGINX -->|Distributes Traffic| BE3
    NGINX -->|Distributes Traffic| BEN
    
    classDef client fill:#64B5F6,stroke:#1976D2,stroke-width:2px,color:#fff
    classDef deploy fill:#E57373,stroke:#D32F2F,stroke-width:2px,color:#fff
    classDef backend fill:#FFB74D,stroke:#F57C00,stroke-width:2px,color:#fff
    classDef nginx fill:#BA68C8,stroke:#7B1FA2,stroke-width:2px,color:#fff
    
    class CLIENT client
    class DEPLOY,DC deploy
    class BE1,BE2,BE3,BEN backend
    class NGINX nginx
```

‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏£‡∏±‡∏ô‡∏î‡πâ‡∏ß‡∏¢‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á `make prod` ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏™‡∏£‡πâ‡∏≤‡∏á

1. Nginx reverse proxy (1 instance)
2. ‡πÅ‡∏≠‡∏û‡∏û‡∏•‡∏¥‡πÄ‡∏Ñ‡∏ä‡∏±‡∏ô backend (3 instances)

‡πÄ‡∏£‡∏≤‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á load balancing ‡πÑ‡∏î‡πâ‡πÇ‡∏î‡∏¢‡πÄ‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö‡∏ó‡∏µ‡πà <http://localhost:8083> ‡πÅ‡∏•‡∏∞‡∏™‡∏±‡∏á‡πÄ‡∏Å‡∏ï `server_id` ‡∏ó‡∏µ‡πà‡πÅ‡∏™‡∏î‡∏á‡∏ö‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö‡∏´‡∏•‡∏≤‡∏¢‡πÜ ‡∏Ñ‡∏£‡∏±‡πâ‡∏á - ‡πÄ‡∏£‡∏≤‡∏Å‡πá‡∏à‡∏∞‡πÄ‡∏´‡πá‡∏ô server_id ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÑ‡∏õ‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á instances ‡∏ó‡∏±‡πâ‡∏á 3 ‡∏ï‡∏±‡∏ß

## Loadtest ‡∏î‡πâ‡∏ß‡∏¢ k6-sse

```sh
cd loadtest/k6-sse

# ‡∏™‡∏≥‡∏£‡∏ß‡∏à‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ï‡πà‡∏≤‡∏á‡πÜ
cat Makefile

# ‡∏™‡∏£‡πâ‡∏≤‡∏á k6 binary with SSE plugin(k6-sse)
make build-loadtest 

### loadtest dev env (‡∏≠‡∏¢‡πà‡∏≤‡∏•‡∏∑‡∏°‡∏£‡∏±‡∏ô app ‡∏î‡πâ‡∏ß‡∏¢ make dev)
make loadtest-dev

### loadtest uat env (‡∏≠‡∏¢‡πà‡∏≤‡∏•‡∏∑‡∏°‡∏£‡∏±‡∏ô app ‡∏î‡πâ‡∏ß‡∏¢ make uat) 
make loadtest-uat

### loadtest prod env (‡∏≠‡∏¢‡πà‡∏≤‡∏•‡∏∑‡∏°‡∏£‡∏±‡∏ô app ‡∏î‡πâ‡∏ß‡∏¢ make prod)
make loadtest-prod
```

‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á loadtest result

![Loadtest Production using k6-sse](/resources/imgs/loadtest-prod.png)

* ‡πÇ‡∏î‡∏¢‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ‡πÄ‡∏£‡∏≤‡∏Ñ‡∏ß‡∏£‡∏à‡∏∞‡∏Ñ‡πà‡∏≠‡∏¢‡πÜ rampup vu ‡∏Ç‡∏∂‡πâ‡∏ô‡πÑ‡∏õ‡∏ô‡∏∞

### Turning

[**Nginx** config](configs/nginx/nginx.prod.conf)

‡∏Ñ‡πà‡∏≤‡πÇ‡∏î‡∏¢ default ‡∏Ç‡∏≠‡∏á nginx ‡πÑ‡∏°‡πà‡∏Ñ‡πà‡∏≠‡∏¢‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏Å‡∏±‡∏ö sse endpoint ‡∏ï‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πà‡∏á‡∏Ñ‡πà‡∏≤‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°

```nginx.conf
    # SSE endpoint 
    location /api/sensors/stream {
        access_log off;     # ‡∏õ‡∏¥‡∏î‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å log ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡∏õ‡∏£‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏†‡∏≤‡∏û‡πÉ‡∏ô‡∏Å‡∏£‡∏ì‡∏µ‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏°‡∏≤‡∏Å
        
        proxy_pass http://backend;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;

        # ‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö SSE
        proxy_buffering off;                # ‡∏õ‡∏¥‡∏î‡∏Å‡∏≤‡∏£ buffer ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ñ‡∏π‡∏Å‡∏™‡πà‡∏á‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
        proxy_cache off;                    # ‡∏õ‡∏¥‡∏î‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ cache
        proxy_http_version 1.1;             # ‡πÉ‡∏ä‡πâ HTTP 1.1
        proxy_set_header Connection "";     # ‡∏õ‡∏¥‡∏î keep-alive ‡∏à‡∏≤‡∏Å client ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö long polling

        # ‡πÄ‡∏û‡∏¥‡πà‡∏° timeouts ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö long connections
        proxy_read_timeout 3600s;           # ‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡πÉ‡∏´‡πâ‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Ñ‡∏á‡∏≠‡∏¢‡∏π‡πà‡πÑ‡∏î‡πâ‡∏ô‡∏≤‡∏ô
        proxy_connect_timeout 300s;
        proxy_send_timeout 300s;
    }

```

[**Linux** ulimits](docker-compose.prod.yml)

```yml
    ulimits:
      nofile:
        soft: 65536
        hard: 65536
```

## References

- [Server-Sent Events (SSE)](https://developer.mozilla.org/en-US/docs/Web/API/Server-sent_events)
- [K6 loadtest tutorial](https://github.com/Napat/k6_loadtest/tree/master)
- [k6-sse extension](https://github.com/phymbert/xk6-sse/)
- [Nginx Load Balancing](https://www.nginx.com/resources/glossary/load-balancing/)
